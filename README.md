# åŒ—äº¬å‡ºè¡Œä¼˜åŒ–æœåŠ¡ - Phase 2

æ™ºèƒ½æ··åˆå‡ºè¡Œå†³ç­–ç³»ç»Ÿ,å¸®åŠ©ç”¨æˆ·åœ¨åœ°é“å’Œæ‰“è½¦ä¹‹é—´æ‰¾åˆ°æœ€ä¼˜æ–¹æ¡ˆã€‚

## åŠŸèƒ½ç‰¹æ€§

### âœ… å·²å®ç° (Phase 2)

- **æ™ºèƒ½æ··åˆæ–¹æ¡ˆç”Ÿæˆ**: è‡ªåŠ¨ç”Ÿæˆ"æ‰“è½¦+åœ°é“"ç»„åˆæ–¹æ¡ˆ
- **ç»¼åˆè¯„åˆ†ç³»ç»Ÿ**: åŸºäºæ—¶é—´ã€è´¹ç”¨ã€èˆ’é€‚åº¦çš„å¤šç»´åº¦è¯„åˆ†
- **åœºæ™¯è¯†åˆ«å¼•æ“**: è‡ªåŠ¨è¯†åˆ«é«˜å³°/æ·±å¤œ/èµ¶è·¯ç­‰åœºæ™¯
- **ä¸ªæ€§åŒ–æ¨è**: æ ¹æ®ç”¨æˆ·åå¥½æ¨èæœ€ä¼˜æ–¹æ¡ˆ
- **ç”¨æˆ·åå¥½æ”¯æŒ**: time(çœæ—¶) / cost(çœé’±) / balance(å¹³è¡¡)

### æ ¸å¿ƒç®—æ³•

1. **æ··åˆæ–¹æ¡ˆç”Ÿæˆ**
   - èµ·ç‚¹æ‰“è½¦ + åœ°é“
   - åœ°é“ + ç»ˆç‚¹æ‰“è½¦
   - æ‰“è½¦ + åœ°é“ + æ‰“è½¦
   - æ™ºèƒ½å‰ªæ(åªä¿ç•™æœ‰ä»·å€¼æ–¹æ¡ˆ)

2. **è¯„åˆ†ç³»ç»Ÿ**
   ```
   ç»¼åˆå¾—åˆ† = æ—¶é—´å¾—åˆ† Ã— æƒé‡1 + è´¹ç”¨å¾—åˆ† Ã— æƒé‡2 + èˆ’é€‚åº¦å¾—åˆ† Ã— æƒé‡3
   ```

3. **åœºæ™¯è¯†åˆ«**
   - æ—¥å¸¸æ¨¡å¼: å¹³è¡¡æƒé‡
   - é«˜å³°æ¨¡å¼: åœ°é“ä¼˜å…ˆ,æ‰“è½¦è´¹ç”¨Ã—1.3
   - æ·±å¤œæ¨¡å¼: å®‰å…¨ä¼˜å…ˆ,æ‰“è½¦è´¹ç”¨Ã—1.5
   - èµ¶è·¯æ¨¡å¼: æ—¶é—´æƒé‡0.8

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
cd ~/Desktop/beijing-commute-optimizer
npm install
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

```bash
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶:
```bash
AMAP_KEY=your_amap_key_here  # é«˜å¾·åœ°å›¾API Key
PORT=3000
CACHE_TTL=300
```

> é«˜å¾·API Keyç”³è¯·: https://lbs.amap.com/

### 3. è¿è¡Œæµ‹è¯•

```bash
npm test
```

æµ‹è¯•ç”¨ä¾‹: å¤§å…´æœºåœº â†’ æ˜Œå¹³åŒ—äº¬äººå®¶å°åŒº

### 4. å¯åŠ¨æœåŠ¡

```bash
npm start
```

æœåŠ¡åœ°å€: http://localhost:3000

## API ä½¿ç”¨ç¤ºä¾‹

### POST /api/routes/plan

**è¯·æ±‚ç¤ºä¾‹:**

```bash
curl -X POST http://localhost:3000/api/routes/plan \
  -H "Content-Type: application/json" \
  -d '{
    "start": {
      "lng": 116.410742,
      "lat": 39.509723,
      "name": "åŒ—äº¬å¤§å…´å›½é™…æœºåœº"
    },
    "end": {
      "lng": 116.293678,
      "lat": 40.072345,
      "name": "åŒ—äº¬äººå®¶å°åŒº"
    },
    "time": "2025-01-06T18:00:00",
    "preference": "balance"
  }'
```

**å“åº”ç¤ºä¾‹:**

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "recommended": {
      "type": "mixed",
      "totalDuration": 93,
      "totalCost": 52.5,
      "segments": [...],
      "scores": {
        "time": 85,
        "cost": 72,
        "comfort": 75,
        "total": 8.6
      },
      "tags": ["æ¨èæ–¹æ¡ˆ", "ç»¼åˆæ€§ä»·æ¯”æœ€é«˜"]
    },
    "fastest": {...},
    "cheapest": {...},
    "allRoutes": [...],
    "meta": {
      "scenario": "é«˜å³°æ¨¡å¼",
      "preference": "balance",
      "totalCandidates": 15
    }
  }
}
```

## é¡¹ç›®ç»“æ„

```
beijing-commute-optimizer/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ amapService.js           # é«˜å¾·åœ°å›¾APIå°è£…
â”‚   â”‚   â””â”€â”€ routePlannerService.js   # è·¯çº¿è§„åˆ’ä¸»æœåŠ¡
â”‚   â”œâ”€â”€ algorithms/
â”‚   â”‚   â””â”€â”€ mixedRouteGenerator.js   # æ··åˆæ–¹æ¡ˆç”Ÿæˆç®—æ³•
â”‚   â”œâ”€â”€ index.js                     # ExpressæœåŠ¡å™¨
â”‚   â””â”€â”€ test.js                      # æµ‹è¯•è„šæœ¬
â”œâ”€â”€ package.json
â”œâ”€â”€ .env.example
â””â”€â”€ README.md
```

## æ ¸å¿ƒç®—æ³•è¯´æ˜

### 1. æ··åˆæ–¹æ¡ˆç”Ÿæˆ

```javascript
// ç­–ç•¥1: èµ·ç‚¹æ‰“è½¦åˆ°åœ°é“ç«™,ç„¶ååœ°é“
generateStartTaxiRoutes(origin, destination, stations)

// ç­–ç•¥2: åœ°é“åˆ°æŸç«™,ç„¶åæ‰“è½¦
generateEndTaxiRoutes(origin, destination, stations)

// ç­–ç•¥3: æ‰“è½¦+åœ°é“+æ‰“è½¦
generateBothTaxiRoutes(origin, destination, stations)

// æ™ºèƒ½å‰ªæ
pruneRoutes(routes) // åˆ é™¤æ‰“è½¦<2kmã€ç»•è·¯ç­‰æ— æ„ä¹‰æ–¹æ¡ˆ
```

### 2. ç»¼åˆè¯„åˆ†

```javascript
æ—¶é—´å¾—åˆ† = 100 Ã— (1 - (å½“å‰æ—¶é—´-æœ€å¿«æ—¶é—´)/(æœ€æ…¢æ—¶é—´-æœ€å¿«æ—¶é—´))
è´¹ç”¨å¾—åˆ† = 100 Ã— (1 - (å½“å‰è´¹ç”¨-æœ€ä½è´¹ç”¨)/(æœ€é«˜è´¹ç”¨-æœ€ä½è´¹ç”¨))
èˆ’é€‚åº¦å¾—åˆ† = 100 - æ¢ä¹˜æ‰£åˆ† - æ­¥è¡Œæ‰£åˆ† - ç­‰å¾…æ‰£åˆ†

ç»¼åˆå¾—åˆ† = (æ—¶é—´å¾—åˆ† Ã— w1 + è´¹ç”¨å¾—åˆ† Ã— w2 + èˆ’é€‚åº¦å¾—åˆ† Ã— w3) / 100
```

### 3. åœºæ™¯è‡ªé€‚åº”æƒé‡

| åœºæ™¯ | æ—¶é—´æƒé‡ | è´¹ç”¨æƒé‡ | èˆ’é€‚åº¦æƒé‡ |
|------|----------|----------|------------|
| æ—¥å¸¸æ¨¡å¼ | 0.4 | 0.4 | 0.2 |
| é«˜å³°æ¨¡å¼ | 0.4 | 0.4 | 0.2 |
| æ·±å¤œæ¨¡å¼ | 0.4 | 0.3 | 0.3 |
| èµ¶è·¯æ¨¡å¼ | 0.8 | 0.1 | 0.1 |

## æµ‹è¯•è¾“å‡ºç¤ºä¾‹

```
====================================
åŒ—äº¬å‡ºè¡Œä¼˜åŒ–æœåŠ¡ - Phase 2 æµ‹è¯•
====================================

ğŸ“ æµ‹è¯•åœºæ™¯:
   èµ·ç‚¹: åŒ—äº¬å¤§å…´å›½é™…æœºåœº
   ç»ˆç‚¹: åŒ—äº¬äººå®¶å°åŒº(æ˜Œå¹³)
   æ—¶é—´: 2025/1/6 18:00:00
   åå¥½: balance

========== å¼€å§‹è·¯çº¿è§„åˆ’ ==========
èµ·ç‚¹: åŒ—äº¬å¤§å…´å›½é™…æœºåœº
ç»ˆç‚¹: åŒ—äº¬äººå®¶å°åŒº(æ˜Œå¹³)
åå¥½: balance
åœºæ™¯è¯†åˆ«: é«˜å³°æ¨¡å¼
  - ç”Ÿæˆçº¯åœ°é“æ–¹æ¡ˆ...
ğŸ”§ ä½¿ç”¨æ¨¡æ‹Ÿåœ°é“æ•°æ®
  - ç”Ÿæˆçº¯æ‰“è½¦æ–¹æ¡ˆ...
ğŸ”§ ä½¿ç”¨æ¨¡æ‹Ÿé©¾è½¦æ•°æ®
  - ç”Ÿæˆæ··åˆæ–¹æ¡ˆ...
ç”Ÿæˆå€™é€‰æ–¹æ¡ˆ: 15 ä¸ª
========== è§„åˆ’å®Œæˆ ==========

====================================
ğŸ“Š è§„åˆ’ç»“æœ
====================================

ğŸ† ã€æ¨èæ–¹æ¡ˆã€‘
   ç±»å‹: æ··åˆå‡ºè¡Œ
   æ€»æ—¶é—´: 86 åˆ†é’Ÿ
   æ€»è´¹ç”¨: Â¥52.3
   ç»¼åˆå¾—åˆ†: 8.7/10
   æ ‡ç­¾: æ¨èæ–¹æ¡ˆ | é«˜å³°æœŸåœ°é“æ›´ç¨³å®š

   è·¯çº¿è¯¦æƒ…:
   1. ğŸš• æ‰“è½¦ åŒ—äº¬å¤§å…´å›½é™…æœºåœº â†’ å¤§å…´æœºåœºç«™
      è·ç¦»:8.5km | æ—¶é•¿:18åˆ†é’Ÿ | è´¹ç”¨:Â¥28.5
   2. ğŸš‡ å¤§å…´æœºåœºçº¿ å¤§å…´æœºåœºç«™ â†’ è‰æ¡¥ç«™
      3ç«™ | 20åˆ†é’Ÿ
   3. ğŸš‡ 4å·çº¿ è‰æ¡¥ç«™ â†’ è¥¿ç›´é—¨ç«™
      18ç«™ | 35åˆ†é’Ÿ
   4. ğŸš• æ‰“è½¦ è¥¿ç›´é—¨ç«™ â†’ åŒ—äº¬äººå®¶å°åŒº(æ˜Œå¹³)
      è·ç¦»:3.2km | æ—¶é•¿:11åˆ†é’Ÿ | è´¹ç”¨:Â¥15.0
```

## ä¸‹ä¸€æ­¥è®¡åˆ’ (Phase 3)

- [ ] æ¥å…¥çœŸå®æ‰“è½¦å¹³å°API (æ»´æ»´/é«˜å¾·)
- [ ] åœ°é“æ‹¥æŒ¤åº¦é¢„æµ‹
- [ ] å®æ—¶è·¯å†µæ›´æ–°
- [ ] å¤©æ°”å› ç´ è€ƒè™‘
- [ ] ç”¨æˆ·å†å²åå¥½å­¦ä¹ 

## æŠ€æœ¯æ ˆ

- **åç«¯**: Node.js + Express
- **åœ°å›¾API**: é«˜å¾·åœ°å›¾ WebæœåŠ¡API
- **ç®—æ³•**: è‡ªç ”æ··åˆè·¯çº¿ç”Ÿæˆ + å¸•ç´¯æ‰˜æœ€ä¼˜å‰ªæ

## License

MIT
